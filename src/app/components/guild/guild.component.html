<div class="guild-page" *ngIf="!isLoading; else loading">
  
  <!-- Header -->
  <div class="guild-header">
    <div class="flex items-center justify-between">
      <h1 class="page-title">
        <i class="fas fa-shield-alt mr-3"></i>
        Ma Guilde
      </h1>
      <button class="back-btn" (click)="goToDashboard()">
        <i class="fas fa-arrow-left mr-2"></i>
        Retour au Dashboard
      </button>
    </div>
  </div>

  <!-- ‚úÖ Messages d'erreur et de succ√®s -->
  <div *ngIf="errorMessage" class="alert alert-error">
    <i class="fas fa-exclamation-triangle mr-2"></i>
    {{ errorMessage }}
    <button *ngIf="errorMessage.includes('Premium')" (click)="goToUpgrade()" class="upgrade-btn">
      Passer au Premium
    </button>
  </div>

  <div *ngIf="successMessage" class="alert alert-success">
    <i class="fas fa-check-circle mr-2"></i>
    {{ successMessage }}
  </div>

  <!-- Si l'utilisateur n'a pas de guilde -->
  <div *ngIf="!guild && !isCreatingGuild" class="no-guild">
    <div class="no-guild-card">
      <div class="no-guild-icon">
        <i class="fas fa-shield-alt"></i>
      </div>
      <h2>Vous n'avez pas encore de guilde</h2>
      <p>Cr√©ez votre propre guilde et invitez d'autres joueurs √† vous rejoindre !</p>
      
      <!-- ‚úÖ Affichage conditionnel selon le statut Premium -->
      <div *ngIf="canCreateGuild(); else needPremium">
        <button class="create-guild-btn" (click)="showCreateForm()">
          <i class="fas fa-plus mr-2"></i>
          Cr√©er ma guilde
        </button>
      </div>
      
      <!-- ‚úÖ Template si Premium requis -->
      <ng-template #needPremium>
        <div class="premium-required">
          <p class="premium-message">
            <i class="fas fa-crown mr-2"></i>
            La cr√©ation de guilde n√©cessite un abonnement Premium
          </p>
          <button class="upgrade-btn" (click)="goToUpgrade()">
            <i class="fas fa-star mr-2"></i>
            Passer au Premium
          </button>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Formulaire de cr√©ation de guilde -->
  <div *ngIf="isCreatingGuild" class="create-guild-form">
    <div class="form-card">
      <h2>
        <i class="fas fa-plus-circle mr-3"></i>
        Cr√©er une nouvelle guilde
      </h2>
      
      <form (ngSubmit)="createGuild()" class="guild-form">
        <div class="form-group">
          <label for="guild-name">Nom de la guilde *</label>
          <input 
            type="text" 
            id="guild-name"
            [(ngModel)]="newGuild.name"
            name="guildName"
            placeholder="Entrez le nom de votre guilde"
            maxlength="50"
            [disabled]="isSubmitting"
            required>
        </div>

        <div class="form-group">
          <label for="guild-description">Description</label>
          <textarea 
            id="guild-description"
            [(ngModel)]="newGuild.description"
            name="guildDescription"
            placeholder="D√©crivez votre guilde..."
            rows="4"
            [disabled]="isSubmitting"
            maxlength="500"></textarea>
        </div>

        <div class="form-info">
          <p>
            <i class="fas fa-info-circle mr-2"></i>
            Date de cr√©ation : <strong>{{ currentDate }}</strong>
          </p>
        </div>

        <div class="form-actions">
          <button type="button" class="cancel-btn" (click)="cancelCreate()" [disabled]="isSubmitting">
            Annuler
          </button>
          <button type="submit" class="submit-btn" [disabled]="!newGuild.name.trim() || isSubmitting">
            <i *ngIf="!isSubmitting" class="fas fa-check mr-2"></i>
            <i *ngIf="isSubmitting" class="fas fa-spinner fa-spin mr-2"></i>
            {{ isSubmitting ? 'Cr√©ation...' : 'Cr√©er la guilde' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Affichage de la guilde existante -->
  <div *ngIf="guild && !isCreatingGuild" class="guild-info">
    <div class="guild-card">
      <div class="guild-header-info">
        <div class="guild-icon">
          <i class="fas fa-shield-alt"></i>
        </div>
        <div class="guild-details">
          <h2>{{ guild.name }}</h2>
          <p class="guild-description">{{ guild.description || 'Aucune description' }}</p>
        </div>
      </div>

      <div class="guild-stats">
        <div class="stat-item">
          <i class="fas fa-users"></i>
          <span>{{ guild.member_count || 1 }}/{{ guild.max_members || 50 }} membres</span>
        </div>
        <div class="stat-item">
          <i class="fas fa-calendar-alt"></i>
          <span>Cr√©√©e le {{ guild.created_at | date:'dd/MM/yyyy' }}</span>
        </div>
      </div>

      <div class="guild-actions">
        <button class="action-btn">
          <i class="fas fa-user-plus mr-2"></i>
          Inviter des membres
        </button>
        <button class="action-btn">
          <i class="fas fa-cog mr-2"></i>
          Param√®tres
        </button>
      </div>
    </div>

    <!-- ‚úÖ AJOUTER cette section dans ton template existant, apr√®s les infos de guilde -->

    <!-- Section Invitations (seulement pour le propri√©taire) -->
    <div class="guild-invitations" *ngIf="guild && isGuildOwner">
      <div class="guild-card mt-4">
        <div class="guild-header-info">
          <div class="guild-icon">
            <i class="fas fa-link"></i>
          </div>
          <div class="guild-details">
            <h2>üîó Invitations de guilde</h2>
            <button 
              (click)="toggleInvitations()" 
              class="action-btn">
              {{ showInvitations ? 'Masquer' : 'Afficher' }} les invitations
            </button>
          </div>
        </div>
        
        <div class="guild-content" *ngIf="showInvitations">
          
          <!-- Formulaire cr√©ation invitation -->
          <div class="create-invitation-section">
            <h3>üìù Cr√©er une nouvelle invitation</h3>
            <div class="invitation-form">
              <div class="form-group">
                <label>Nombre max d'utilisations</label>
                <input 
                  type="number" 
                  [(ngModel)]="invitationForm.maxUses"
                  placeholder="Illimit√©"
                  min="1" 
                  max="100">
              </div>
              <div class="form-group">
                <label>Expire dans (heures)</label>
                <input 
                  type="number" 
                  [(ngModel)]="invitationForm.expiresInHours"
                  placeholder="Jamais"
                  min="1" 
                  max="168">
              </div>
              <div class="form-group">
                <button 
                  (click)="createInvitation()" 
                  class="submit-btn"
                  [disabled]="isCreatingInvitation">
                  <i *ngIf="isCreatingInvitation" class="fas fa-spinner fa-spin mr-2"></i>
                  <i *ngIf="!isCreatingInvitation" class="fas fa-plus mr-2"></i>
                  {{ isCreatingInvitation ? 'Cr√©ation...' : 'Cr√©er invitation' }}
                </button>
              </div>
            </div>
          </div>

          <!-- Loading invitations -->
          <div *ngIf="isLoadingInvitations" class="loading-section">
            <div class="loading-spinner"></div>
            <p>Chargement des invitations...</p>
          </div>

          <!-- Liste des invitations -->
          <div class="invitations-list" *ngIf="!isLoadingInvitations">
            <h3 *ngIf="invitations.length > 0">üìã Mes invitations ({{ invitations.length }})</h3>
            
            <div class="no-invitations" *ngIf="invitations.length === 0">
              <div class="no-guild-icon">
                <i class="fas fa-envelope"></i>
              </div>
              <p>Aucune invitation cr√©√©e pour le moment.</p>
            </div>

            <div class="invitation-item" *ngFor="let invitation of invitations">
              <div class="invitation-card">
                
                <!-- Info invitation -->
                <div class="invitation-info">
                  <div class="invitation-code">
                    <strong>Code:</strong> 
                    <code>{{ invitation.code }}</code>
                  </div>
                  <div class="invitation-url">
                    <label>URL d'invitation:</label>
                    <div class="url-input-group">
                      <input 
                        readonly 
                        [value]="invitation.url" 
                        class="url-input">
                      <button 
                        (click)="copyToClipboard(invitation.url)" 
                        class="copy-btn">
                        üìã Copier
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Stats invitation -->
                <div class="invitation-stats">
                  <div class="stat-item" *ngIf="invitation.max_uses">
                    <i class="fas fa-users"></i>
                    <span>{{ invitation.uses_count }}/{{ invitation.max_uses }} utilisations</span>
                  </div>
                  <div class="stat-item" *ngIf="invitation.expires_at">
                    <i class="fas fa-clock"></i>
                    <span>Expire: {{ invitation.expires_at | date:'dd/MM/yyyy HH:mm' }}</span>
                  </div>
                  <div class="stat-item">
                    <span 
                      class="status-badge"
                      [class.valid]="invitation.is_valid"
                      [class.invalid]="!invitation.is_valid">
                      {{ invitation.is_valid ? '‚úÖ Valide' : '‚ùå Invalide' }}
                    </span>
                  </div>
                </div>

                <!-- Actions -->
                <div class="invitation-actions">
                  <button 
                    *ngIf="invitation.is_active"
                    (click)="deactivateInvitation(invitation.id)" 
                    class="action-btn danger">
                    <i class="fas fa-trash mr-2"></i>
                    D√©sactiver
                  </button>
                  <span *ngIf="!invitation.is_active" class="disabled-text">
                    D√©sactiv√©e
                  </span>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading template -->
<ng-template #loading>
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <p>Chargement des informations de guilde...</p>
  </div>
</ng-template>
