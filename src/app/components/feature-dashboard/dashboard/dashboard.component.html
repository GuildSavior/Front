<!-- Si user est défini, on affiche les infos -->
<div class="dashboard" *ngIf="user; else loading">
  <div class="dashboard-container">
    <!-- Colonne Infos Utilisateur -->
    <section class="user-info">
      <div class="avatar-block">
        <img [src]="user.avatar" alt="Avatar" class="avatar" />
        <div class="user-basic">
          <h2>{{ user.username }}</h2>
          <button class="show-sensitive-btn" (click)="showSensitive = !showSensitive">
            {{ showSensitive ? 'Masquer' : 'Afficher les infos sensibles' }}
          </button>
          <div 
            class="sensitive-info" 
            *ngIf="showSensitive"
            [@fadeSlide]>
            <p class="user-email">{{ user.email }}</p>
            <p class="user-id">ID Discord : {{ user.discord_id }}</p>
          </div>
        </div>
      </div>
      
      <!-- ✅ NOUVEAU: Statut Premium -->
      <div class="premium-status" [ngClass]="getPremiumBadgeClass()">
        <div *ngIf="isPremium()" class="premium-badge premium-active">
          <i class="fas fa-crown"></i>
          <div class="premium-info">
            <span class="premium-label">Premium</span>
            <span class="premium-expiry">Expire le {{ getSubscriptionInfo()?.formattedExpiry }}</span>
          </div>
        </div>
        
        <div *ngIf="!isPremium()" class="premium-badge premium-none">
          <i class="fas fa-star"></i>
          <div class="premium-info">
            <span class="premium-label">Free</span>
            <span class="premium-upgrade">Passez au Premium</span>
          </div>
        </div>
      </div>

      <div class="user-details">
        <p><strong>Total DKP :</strong> {{ user.total_dkp }}</p>
        <label for="classe-select"><strong>Classe :</strong></label>
        <select id="classe-select" [(ngModel)]="player.classe">
          <option value="support">Support</option>
          <option value="tank">Tank</option>
          <option value="dps">DPS</option>
          <option value="range">Range</option>
          <option value="mage">Mage</option>
        </select>
      </div>
    </section>

    <!-- Colonne Actions/Stats -->
    <section class="user-actions">
      <h3>Actions rapides</h3>
      <button class="dashboard-btn">Voir ma guilde</button>

      <div class="dashboard-stats">
        <h4>Statistiques</h4>
        <ul>
          <li>Événements rejoints : <strong>{{ player.events_joined || 0 }}</strong></li>
        </ul>
      </div>
    </section>
  </div>
</div>

<!-- Template de fallback pendant le chargement -->
<ng-template #loading>
  <p class="text-gray-500">Chargement des informations...</p>
</ng-template>

<!-- Notification en bas à droite -->
<div *ngIf="notification" class="dashboard-notification">
  {{ notification }}
</div>
