<div class="player-profile-container">
  <!-- ✅ Header avec bouton retour -->
  <div class="profile-header">
    <button class="back-btn" (click)="goBack()">
      <i class="fas fa-arrow-left"></i>
      Retour aux membres
    </button>
    <h1 *ngIf="isLoading">Chargement...</h1>
  </div>

  <!-- ✅ Loading -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Chargement du profil...</p>
  </div>

  <!-- ✅ Error -->
  <div *ngIf="errorMessage && !isLoading" class="error-state">
    <div class="error-content">
      <i class="fas fa-exclamation-triangle"></i>
      <h3>Erreur</h3>
      <p>{{ errorMessage }}</p>
      <button class="btn-retry" (click)="loadPlayerProfile()">
        <i class="fas fa-refresh"></i>
        Réessayer
      </button>
    </div>
  </div>

  <!-- ✅ Profil du joueur -->
  <div *ngIf="!isLoading && !errorMessage && player" class="profile-content">
    
    <!-- ✅ Carte principale du personnage -->
    <div class="character-main-card">
      <div class="character-header">
        <div class="character-avatar">
          <!-- ✅ REMPLACER l'icône par l'avatar Discord -->
          <div class="avatar-ring" [style.border-color]="getClassColor(player.class)">
            <img 
              *ngIf="player.user?.avatar" 
              [src]="player.user.avatar" 
              [alt]="player.user.username"
              class="discord-avatar">
            <i 
              *ngIf="!player.user?.avatar" 
              class="fas fa-user-circle fallback-icon"></i>
          </div>
          <div class="class-badge" [style.background-color]="getClassColor(player.class)">
            {{ getClassDisplayName(player.class) }}
          </div>
        </div>
        
        <div class="character-info">
          <h2 class="character-name">{{ player.name }}</h2>
          <!-- ✅ AJOUTER le nom Discord -->
          <div class="discord-username">
            <i class="fab fa-discord"></i>
            {{ player.user.username }}
          </div>
          <div class="character-level">
            <i class="fas fa-level-up-alt"></i>
            Niveau {{ player.level }}
          </div>
          <div class="character-class" [style.color]="getClassColor(player.class)">
            {{ getClassDisplayName(player.class) }}
          </div>
        </div>
      </div>
    </div>

    <!-- ✅ Grille des statistiques -->
    <div class="stats-grid">
      
      <!-- DKP Card -->
      <div class="stat-card dkp-card">
        <div class="stat-icon">
          <i class="fas fa-coins"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ player.dkp || 0 }}</div>
          <div class="stat-label">Points DKP</div>
          <div class="stat-description">Points de présences</div>
        </div>
      </div>

      <!-- Events Card -->
      <div class="stat-card events-card">
        <div class="stat-icon">
          <i class="fas fa-calendar-check"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ player.events_joined || 0 }}</div>
          <div class="stat-label">Événements</div>
          <div class="stat-description">Raids ou autres rejoints</div>
        </div>
      </div>

      <!-- Level Progress Card -->
      <div class="stat-card level-card">
        <div class="stat-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ ((player.level / 55) * 100) | number:'1.0-1' }}%</div>
          <div class="stat-label">Progression</div>
          <div class="stat-description">Niveau {{ player.level }}/55</div>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="(player.level / 55) * 100"></div>
          </div>
        </div>
      </div>

      <!-- Performance Card -->
      <div class="stat-card performance-card">
        <div class="stat-icon">
          <i class="fas fa-trophy"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ getPerformanceScore() }}</div>
          <div class="stat-label">Score</div>
          <div class="stat-description">Performance globale</div>
        </div>
      </div>
    </div>

    <!-- ✅ Informations détaillées -->
    <div class="details-section">
      <h3>Informations détaillées</h3>
      
      <div class="details-grid">
        <div class="detail-item">
          <div class="detail-label">
            <i class="fas fa-user"></i>
            Nom du personnage
          </div>
          <div class="detail-value">{{ player.name }}</div>
        </div>

        <div class="detail-item">
          <div class="detail-label">
            <i class="fas fa-level-up-alt"></i>
            Niveau actuel
          </div>
          <div class="detail-value">{{ player.level }}</div>
        </div>

        <div class="detail-item">
          <div class="detail-label">
            <i class="fas fa-shield-alt"></i>
            Classe/Rôle
          </div>
          <div class="detail-value" [style.color]="getClassColor(player.class)">
            {{ getClassDisplayName(player.class) }}
          </div>
        </div>

        <div class="detail-item">
          <div class="detail-label">
            <i class="fas fa-coins"></i>
            Points DKP
          </div>
          <div class="detail-value">{{ player.dkp || 0 }}</div>
        </div>

        <div class="detail-item">
          <div class="detail-label">
            <i class="fas fa-calendar-plus"></i>
            Événements rejoints
          </div>
          <div class="detail-value">{{ player.events_joined || 0 }}</div>
        </div>

        <div class="detail-item" *ngIf="player.created_at">
          <div class="detail-label">
            <i class="fas fa-clock"></i>
            Profil créé le
          </div>
          <div class="detail-value">{{ player.created_at | date:'dd/MM/yyyy' }}</div>
        </div>
      </div>
    </div>

    <!-- ✅ Badges de réalisations (optionnel) -->
    <div class="achievements-section">
      <h3>Réalisations</h3>
      <div class="achievements-grid">
        
        <div class="achievement-badge" [class.earned]="player.level >= 50">
          <i class="fas fa-star"></i>
          <span>Vétéran</span>
          <small>Niveau 50+</small>
        </div>

        <div class="achievement-badge" [class.earned]="(player.dkp || 0) >= 500">
          <i class="fas fa-coins"></i>
          <span>Collectionneur</span>
          <small>500+ DKP</small>
        </div>

        <div class="achievement-badge" [class.earned]="(player.events_joined || 0) >= 10">
          <i class="fas fa-users"></i>
          <span>Fidèle</span>
          <small>10+ raids</small>
        </div>

        <div class="achievement-badge" [class.earned]="player.level === 55">
          <i class="fas fa-crown"></i>
          <span>Niveau Max</span>
          <small>Niveau 55</small>
        </div>
      </div>
    </div>
  </div>
</div>
